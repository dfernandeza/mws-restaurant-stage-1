window.getScript=function(n,t){var e=document.createElement("script");e.onload=t,e.src=n,document.body.appendChild(e)},navigator.serviceWorker&&window.addEventListener("load",function(){navigator.serviceWorker.register("/sw.js").then(function(n){navigator.serviceWorker.controller&&(n.waiting?console.log("waiting"):n.installing?console.log("installing"):n.addEventListener("updatefound",function(){console.log("updatefound")}))})});var n=function(){function r(n,t){for(var e=0;e<t.length;e++){var r=t[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}return function(n,t,e){return t&&r(n.prototype,t),e&&r(n,e),n}}();var t=1;var u=idb.open("foodle",t,function(n){switch(n.oldVersion){case 0:var t=n.createObjectStore("restaurants",{keyPath:"id"});t.createIndex("id","id"),t.createIndex("by-date","createdAt")}}),DBHelperClass=function(){function DBHelperClass(){!function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}(this,DBHelperClass)}return n(DBHelperClass,null,[{key:"fetchRestaurants",value:function(t){u.then(function(n){if(n)return n.transaction("restaurants").objectStore("restaurants").index("by-date").getAll().then(function(n){return t(null,n)}).catch(function(n){return t(n,null)})}).then(function(){return fetch(DBHelper.DATABASE_URL).then(function(n){return n.json()}).then(function(r){return u.then(function(n){if(n){var t=n.transaction("restaurants","readwrite").objectStore("restaurants"),e=t.index("by-date");return r.forEach(function(n){t.put(n)}),e.openCursor(null,"prev")}}).then(function(n){if(n)return n.advance(10)}).then(function n(t){if(t)return t.delete(),t.continue().then(n)}),r}).then(function(n){return t(null,n)}).catch(function(n){return t(n,null)})})}},{key:"fetchRestaurantById",value:function(e,r){u.then(function(n){if(n)return n.transaction("restaurants").objectStore("restaurants").index("id").get(parseInt(e,10)).then(function(n){return r(null,n),n}).catch(function(n){return r(n,null)})}).then(function(t){return fetch(DBHelper.DATABASE_URL+e).then(function(n){return n.json()}).then(function(t){return u.then(function(n){if(n)return n.transaction("restaurants","readwrite").objectStore("restaurants").put(t),t})}).then(function(n){return!t&&r(null,n)}).catch(function(n){return r(n,null)})})}},{key:"fetchRestaurantByCuisine",value:function(r,u){DBHelper.fetchRestaurants(function(n,t){if(n)u(n,null);else{var e=t.filter(function(n){return n.cuisine_type==r});u(null,e)}})}},{key:"fetchRestaurantByNeighborhood",value:function(r,u){DBHelper.fetchRestaurants(function(n,t){if(n)u(n,null);else{var e=t.filter(function(n){return n.neighborhood==r});u(null,e)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(r,u,o){DBHelper.fetchRestaurants(function(n,t){if(n)o(n,null);else{var e=t;"all"!=r&&(e=e.filter(function(n){return n.cuisine_type==r})),"all"!=u&&(e=e.filter(function(n){return n.neighborhood==u})),o(null,e)}})}},{key:"fetchNeighborhoods",value:function(u){DBHelper.fetchRestaurants(function(n,e){if(n)u(n,null);else{var r=e.map(function(n,t){return e[t].neighborhood}),t=r.filter(function(n,t){return r.indexOf(n)==t});u(null,t)}})}},{key:"fetchCuisines",value:function(u){DBHelper.fetchRestaurants(function(n,e){if(n)u(n,null);else{var r=e.map(function(n,t){return e[t].cuisine_type}),t=r.filter(function(n,t){return r.indexOf(n)==t});u(null,t)}})}},{key:"markAsFavorite",value:function(n,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:function(){return null};fetch(""+DBHelper.DATABASE_URL+n,{method:"PUT",body:JSON.stringify({is_favorite:!(!t||"false"===t)}),headers:{"Content-Type":"application/json"}}).then(function(n){return n.json()}).then(function(e){u.then(function(n){var t=n.transaction("restaurants","readwrite").objectStore("restaurants");return r(null,e),t.put(e)})}).catch(function(n){return r(n,null)})}},{key:"urlForRestaurant",value:function(n){return"./restaurant.html?id="+n.id}},{key:"imageUrlForRestaurant",value:function(n){var t=n.photograph,e=void 0===t?"foodle":t;return"/img/"+{lg:e+".jpg",sm:e+"_sm.jpg",sm2x:e+"_sm2x.jpg"}[1<arguments.length&&void 0!==arguments[1]?arguments[1]:"lg"]}},{key:"mapMarkerForRestaurant",value:function(n,t){return new google.maps.Marker({position:n.latlng,title:n.name,url:DBHelper.urlForRestaurant(n),map:t,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337/restaurants/"}}]),DBHelperClass}();window.DBHelper=DBHelperClass;
//# sourceMappingURL=helpers-bundle.js.map
