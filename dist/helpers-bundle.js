function n(){var n=document.getElementById("connection-status");navigator.onLine?n.classList.add("hidden"):n.classList.remove("hidden")}window.getScript=function(n,e){var t=document.createElement("script");t.onload=e,t.src=n,document.body.appendChild(t)},window.addEventListener("online",n),window.addEventListener("offline",n),n(),navigator.serviceWorker&&window.addEventListener("load",function(){navigator.serviceWorker.register("/sw.js").then(function(n){navigator.serviceWorker.controller&&(n.waiting?console.log("waiting"):n.installing?console.log("installing"):n.addEventListener("updatefound",function(){console.log("updatefound")}))}),navigator.serviceWorker.ready.then(function(n){return n.sync.register("foodle-sync").catch(console.log)})});var e=function(){function r(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}return function(n,e,t){return e&&r(n.prototype,e),t&&r(n,t),n}}();var t=2;var u=idb.open("foodle",t,function(n){switch(n.oldVersion){case 0:var e=n.createObjectStore("restaurants",{keyPath:"id"});e.createIndex("id","id"),e.createIndex("by-date","createdAt");case 1:var t=n.createObjectStore("reviews",{keyPath:"id"});t.createIndex("id","id"),t.createIndex("by-date","createdAt"),t.createIndex("by-restaurant","restaurant_id")}}),DBHelperClass=function(){function DBHelperClass(){!function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}(this,DBHelperClass)}return e(DBHelperClass,null,[{key:"fetchRestaurants",value:function(e){u.then(function(n){if(n)return n.transaction("restaurants").objectStore("restaurants").index("by-date").getAll().then(function(n){return e(null,n)}).catch(function(n){return e(n,null)})}).then(function(){return fetch(DBHelper.DATABASE_URL).then(function(n){return n.json()}).then(function(r){return u.then(function(n){if(n){var e=n.transaction("restaurants","readwrite").objectStore("restaurants"),t=e.index("by-date");return r.forEach(function(n){e.put(n)}),t.openCursor(null,"prev")}}).then(function(n){if(n)return n.advance(10)}).then(function n(e){if(e)return e.delete(),e.continue().then(n)}),r}).then(function(n){return e(null,n)}).catch(function(n){return e(n,null)})})}},{key:"fetchRestaurantById",value:function(t,r){u.then(function(n){if(n)return n.transaction("restaurants").objectStore("restaurants").index("id").get(parseInt(t,10)).then(function(n){return r(null,n),n}).catch(function(n){return r(n,null)})}).then(function(e){return fetch(DBHelper.DATABASE_URL+t).then(function(n){return n.json()}).then(function(e){return u.then(function(n){if(n)return n.transaction("restaurants","readwrite").objectStore("restaurants").put(e),e})}).then(function(n){return!e&&r(null,n)}).catch(function(n){return r(n,null)})})}},{key:"fetchRestaurantByCuisine",value:function(r,u){DBHelper.fetchRestaurants(function(n,e){if(n)u(n,null);else{var t=e.filter(function(n){return n.cuisine_type==r});u(null,t)}})}},{key:"fetchRestaurantByNeighborhood",value:function(r,u){DBHelper.fetchRestaurants(function(n,e){if(n)u(n,null);else{var t=e.filter(function(n){return n.neighborhood==r});u(null,t)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(r,u,i){DBHelper.fetchRestaurants(function(n,e){if(n)i(n,null);else{var t=e;"all"!=r&&(t=t.filter(function(n){return n.cuisine_type==r})),"all"!=u&&(t=t.filter(function(n){return n.neighborhood==u})),i(null,t)}})}},{key:"fetchNeighborhoods",value:function(u){DBHelper.fetchRestaurants(function(n,t){if(n)u(n,null);else{var r=t.map(function(n,e){return t[e].neighborhood}),e=r.filter(function(n,e){return r.indexOf(n)==e});u(null,e)}})}},{key:"fetchCuisines",value:function(u){DBHelper.fetchRestaurants(function(n,t){if(n)u(n,null);else{var r=t.map(function(n,e){return t[e].cuisine_type}),e=r.filter(function(n,e){return r.indexOf(n)==e});u(null,e)}})}},{key:"fetchReviewsByRestaurant",value:function(e,t){u.then(function(n){if(n)return n.transaction("reviews").objectStore("reviews").index("by-restaurant").getAll(parseInt(e,10)).then(function(n){return t(null,n)}).catch(function(n){return t(n,null)})}).then(function(){return fetch(DBHelper.REVIEWS_DATABASE_URL+"?restaurant_id="+e).then(function(n){return n.json()}).then(function(r){return u.then(function(n){if(n){var e=n.transaction("reviews","readwrite").objectStore("reviews"),t=e.index("by-restaurant");return r.forEach(function(n){e.put(n)}),t.openCursor(null,"prev")}}).then(function(n){if(n)return n.advance(10)}).then(function n(e){if(e)return e.delete(),e.continue().then(n)}),r}).then(function(n){return t(null,n)}).catch(function(n){return t(n,null)})})}},{key:"markAsFavorite",value:function(n,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:function(){return null};fetch(""+DBHelper.DATABASE_URL+n,{method:"PUT",body:JSON.stringify({is_favorite:!(!e||"false"===e)}),headers:{"Content-Type":"application/json"}}).then(function(n){return n.json()}).then(function(t){u.then(function(n){var e=n.transaction("restaurants","readwrite").objectStore("restaurants");return r(null,t),e.put(t)})}).catch(function(n){return r(n,null)})}},{key:"addReview",value:function(n){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){return null};fetch(DBHelper.REVIEWS_DATABASE_URL,{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then(function(n){return n.json()}).then(function(e){return u.then(function(n){if(n)return n.transaction("reviews","readwrite").objectStore("reviews").put(e),e})}).then(function(n){return e(null,n)}).catch(function(n){e(n,null)})}},{key:"urlForRestaurant",value:function(n){return"./restaurant.html?id="+n.id}},{key:"imageUrlForRestaurant",value:function(n){var e=n.photograph,t=void 0===e?"foodle":e;return"/img/"+{lg:t+".jpg",sm:t+"_sm.jpg",sm2x:t+"_sm2x.jpg"}[1<arguments.length&&void 0!==arguments[1]?arguments[1]:"lg"]}},{key:"mapMarkerForRestaurant",value:function(n,e){return new google.maps.Marker({position:n.latlng,title:n.name,url:DBHelper.urlForRestaurant(n),map:e,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337/restaurants/"}},{key:"REVIEWS_DATABASE_URL",get:function(){return"http://localhost:1337/reviews/"}}]),DBHelperClass}();window.DBHelper=DBHelperClass;
//# sourceMappingURL=helpers-bundle.js.map
